# План реализации функций AI-обработки статей

## Описание проекта
Приложение получает на входе адрес англоязычной статьи, выполняет парсинг и, по соответствующей кнопке, подключает AI и выполняет нужное действие.

## Текущее состояние
- ✅ Реализован парсинг статей (извлечение даты, заголовка, контента)
- ✅ Реализован перевод статей через OpenRouter API (модель Deepseek)
- ⏳ Кнопки "О чем статья?", "Тезисы", "Пост для Telegram" требуют реализации AI-обработки

## План действий

### Этап 1: Создание универсального API route для AI-обработки

#### 1.1. Создать файл `app/api/ai-process/route.ts`
- Использовать OpenRouter API (как в translate route)
- Принимать параметры:
  - `content` - текст статьи для обработки
  - `action` - тип действия: 'summary' | 'thesis' | 'telegram'
- Возвращать результат обработки

#### 1.2. Настроить промпты для каждого типа действия:
- **"О чем статья?" (summary)**: Краткое содержание статьи (2-3 абзаца)
- **"Тезисы" (thesis)**: Структурированный список основных тезисов статьи
- **"Пост для Telegram" (telegram)**: Форматированный пост для Telegram канала

#### 1.3. Использовать модель Deepseek через OpenRouter API
- Модель: `deepseek/deepseek-chat`
- API ключ из `process.env.OPENROUTER_API_KEY`
- Настроить параметры: `temperature`, `max_tokens`

### Этап 2: Обновление функции handleSubmit в компоненте

#### 2.1. Модифицировать функцию `handleSubmit` в `app/page.tsx`
- Текущая логика: только парсинг и вывод JSON
- Новая логика:
  1. Парсинг статьи (как сейчас)
  2. Извлечение контента из результата парсинга
  3. Отправка контента в `/api/ai-process` с указанием типа действия
  4. Вывод результата AI-обработки в поле "Результат"

#### 2.2. Обработка ошибок
- Валидация наличия контента после парсинга
- Обработка ошибок API
- Показ понятных сообщений об ошибках пользователю

### Этап 3: Реализация промптов для каждого типа действия

#### 3.1. Промпт для "О чем статья?" (summary)
```
Системное сообщение: "Ты опытный аналитик и журналист. Твоя задача - создать краткое, но информативное содержание статьи."

Пользователь: "Создай краткое содержание следующей статьи (2-3 абзаца), выделив основные идеи и ключевые моменты:\n\n{content}"
```

#### 3.2. Промпт для "Тезисы" (thesis)
```
Системное сообщение: "Ты эксперт по анализу текстов. Твоя задача - выделить основные тезисы статьи в структурированном виде."

Пользователь: "Выдели основные тезисы следующей статьи. Представь их в виде пронумерованного списка, где каждый пункт - это отдельный тезис:\n\n{content}"
```

#### 3.3. Промпт для "Пост для Telegram" (telegram)
```
Системное сообщение: "Ты копирайтер, специализирующийся на создании постов для Telegram. Твоя задача - создать привлекательный и информативный пост."

Пользователь: "Создай пост для Telegram канала на основе следующей статьи. Пост должен быть:\n- Привлекательным и цепляющим\n- Содержать основные идеи статьи\n- Использовать эмодзи для визуального оформления\n- Иметь призыв к действию\n- Быть структурированным (заголовок, основной текст, хэштеги)\n\nСтатья:\n{content}"
```

### Этап 4: Тестирование и оптимизация

#### 4.1. Тестирование каждого типа действия
- Проверить работу с разными типами статей
- Убедиться, что результаты соответствуют ожиданиям
- Проверить обработку длинных статей (возможна необходимость разбиения на части)

#### 4.2. Оптимизация промптов
- На основе результатов тестирования скорректировать промпты
- Настроить параметры `temperature` и `max_tokens` для каждого типа действия

#### 4.3. Обработка edge cases
- Статьи без контента
- Очень длинные статьи (возможна необходимость chunking)
- Ошибки API OpenRouter
- Таймауты запросов

### Этап 5: Улучшение UX

#### 5.1. Визуальная обратная связь
- Показывать прогресс обработки (уже реализовано через `loading`)
- Разные индикаторы для разных этапов (парсинг → AI обработка)

#### 5.2. Форматирование результата
- Для "Тезисы": сохранить нумерацию и структуру
- Для "Пост для Telegram": сохранить форматирование с эмодзи
- Для "О чем статья?": читабельные абзацы

## Порядок реализации

1. **Сначала**: Создать API route `/api/ai-process` с базовой структурой
2. **Затем**: Реализовать промпт для одного типа действия (например, "О чем статья?")
3. **Потом**: Обновить `handleSubmit` для использования нового API
4. **Далее**: Добавить остальные промпты (Тезисы, Пост для Telegram)
5. **В конце**: Тестирование и оптимизация

## Технические детали

### Структура API route
```typescript
POST /api/ai-process
Body: {
  content: string,
  action: 'summary' | 'thesis' | 'telegram'
}
Response: {
  result: string
}
```

### Параметры для OpenRouter API
- `temperature`: 0.3-0.7 (в зависимости от типа действия)
- `max_tokens`: 2000-4000 (в зависимости от типа действия)
- `model`: `deepseek/deepseek-chat`

### Обработка длинных статей
Если статья слишком длинная (>8000 токенов), можно:
- Разбить на части и обработать каждую отдельно
- Или использовать более агрессивное сокращение контента перед отправкой

